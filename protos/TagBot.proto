#VRML_SIM R2025a utf8

PROTO TagBot [
  field SFVec3f    translation 0 0.025 0
  field SFRotation rotation    0 1 0 0
  field SFString   name        "TagBot"
  field SFString   controller  "chaser_controller"
  field SFColor    bodyColor   0 0 1
]
{
  Robot {
    translation IS translation
    rotation IS rotation
    name IS name
    controller IS controller

    children [
      # ===== Cuerpo (cilindro azul) =====
      Transform {
        translation 0 0.05 0
        children [
          Shape {
            appearance PBRAppearance {
              baseColor IS bodyColor
              roughness 0.6
              metalness 0
            }
            geometry Cylinder {
              radius 0.035
              height 0.08
            }
          }
        ]
      }

      # ===== Rueda izquierda (roja) =====
      # Centro rueda a y=0.025 (radio=0.025) => toca suelo
      HingeJoint {
        jointParameters HingeJointParameters {
          anchor -0.045 0.025 0
          axis 1 0 0
        }
        device [
          RotationalMotor {
            name "motor_1"
            maxVelocity 20
            maxTorque 8
          }
        ]
        endPoint Solid {
          name "left_wheel"
          translation -0.045 0.025 0
          rotation 0 0 1 1.5708
          children [
            Shape {
              appearance PBRAppearance {
                baseColor 1 0 0
                roughness 0.9
                metalness 0
              }
              geometry Cylinder {
                radius 0.025
                height 0.01
              }
            }
          ]
          boundingObject Cylinder {
            radius 0.025
            height 0.01
          }
          physics Physics { density 900 }
          contactMaterial "wheel"
        }
      }

      # ===== Rueda derecha (roja) =====
      HingeJoint {
        jointParameters HingeJointParameters {
          anchor 0.045 0.025 0
          axis 1 0 0
        }
        device [
          RotationalMotor {
            name "motor_2"
            maxVelocity 20
            maxTorque 8
          }
        ]
        endPoint Solid {
          name "right_wheel"
          translation 0.045 0.025 0
          rotation 0 0 1 1.5708
          children [
            Shape {
              appearance PBRAppearance {
                baseColor 1 0 0
                roughness 0.9
                metalness 0
              }
              geometry Cylinder {
                radius 0.025
                height 0.01
              }
            }
          ]
          boundingObject Cylinder {
            radius 0.025
            height 0.01
          }
          physics Physics { density 900 }
          contactMaterial "wheel"
        }
      }

      # ===== Caster trasero (negro) =====
      Solid {
        name "caster"
        translation 0 0.008 -0.03
        children [
          Shape {
            appearance PBRAppearance { baseColor 0.05 0.05 0.05 roughness 0.9 }
            geometry Sphere { radius 0.008 }
          }
        ]
        boundingObject Sphere { radius 0.008 }
        physics Physics { density 900 }
        contactMaterial "caster"
      }

      # ===== Sensores para perseguir/evitar =====
      GPS { name "gps" }
      Compass { name "compass" }
      Receiver { name "receiver" channel 1 }

      DistanceSensor {
        name "ds_left"
        translation 0.04 0.06 0.03
        lookupTable [ 0 1000 0, 0.25 0 0 ]
        type "infra-red"
      }
      DistanceSensor {
        name "ds_right"
        translation 0.04 0.06 -0.03
        lookupTable [ 0 1000 0, 0.25 0 0 ]
        type "infra-red"
      }
    ]

    # colisi√≥n principal: solo el cuerpo, levantado
    boundingObject Transform {
      translation 0 0.05 0
      children [
        Cylinder { radius 0.035 height 0.08 }
      ]
    }
    physics Physics { density 900 }
  }
}
